{
    "name": "DTProblems2DCR",
    "apiVersion": "2021-09-01-preview",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "{{location}}",
    "properties": {
        "streamDeclarations": {
            "Custom-DynatraceProblemsV2": {
                "columns": [
                    {
                        "name": "type",
                        "type": "string"
                    },
                    {
                        "name": "problemId",
                        "type": "string"
                    },
                    {
                        "name": "displayId",
                        "type": "string"
                    },
                    {
                        "name": "title",
                        "type": "string"
                    },
                    {
                        "name": "impactLevel",
                        "type": "string"
                    },
                    {
                        "name": "severityLevel",
                        "type": "string"
                    },
                    {
                        "name": "status",
                        "type": "string"
                    },
                    {
                        "name": "affectedEntities",
                        "type": "dynamic"
                    },
                    {
                        "name": "impactedEntities",
                        "type": "dynamic"
                    },
                    {
                        "name": "rootCauseEntity",
                        "type": "dynamic"
                    },
                    {
                        "name": "managementZones",
                        "type": "dynamic"
                    },
                    {
                        "name": "entityTags",
                        "type": "dynamic"
                    },
                    {
                        "name": "problemFilters",
                        "type": "dynamic"
                    },
                    {
                        "name": "startTime",
                        "type": "int"
                    },
                    {
                        "name": "endTime",
                        "type": "int"
                    },
                    {
                        "name": "evidenceDetails",
                        "type": "dynamic"
                    },
                    {
                        "name": "recentComments",
                        "type": "dynamic"
                    },
                    {
                        "name": "impactAnalysis",
                        "type": "dynamic"
                    }
                ]
            }
        },
        "destinations": {
            "logAnalytics": [
                {
                    "workspaceResourceId": "{{workspaceResourceId}}",
                    "name": "clv2ws1"
                }
            ]
        },
        "dataFlows": [
            {
                "streams": [
                    "Custom-DynatraceProblemsV2"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "let fromUnixTime = (t: long) {\ndatetime(1970-01-01) + t * 1ms\n};\nsource | extend TimeGenerated = fromUnixTime(startTime) | project-away type | project-rename problemTitle = title",
                "outputStream": "Custom-DynatraceProblemsV2_CL"
            }
        ],
        "dataCollectionEndpointId": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]"
    }
}