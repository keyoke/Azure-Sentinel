{
    "type": "Microsoft.SecurityInsights/dataConnectors",
    "apiVersion": "2021-10-01-preview",
    "name": "DynatraceAttacks2",
    "location": "{{location}}",
    "kind": "RestApiPoller",
    "properties": {
        "connectorDefinitionName": "DynatraceAttacksConnectorCCPDefinition",
        "dataType": "DynatraceAttacksV2_CL",
        "auth": {
            "type": "APIKey",
            "ApiKey": "[[parameters('dynatraceAccessToken')]",
            "APIKeyIdentifier": "Api-Token",
            "APIKeyName": "Authorization"
        },
        "request": {
            "apiEndpoint": "[[concat('https://',parameters('dynatraceEnvironmentUrl'),'/api/v2/attacks')]",
            "httpMethod": "Get",
            "rateLimitQPS": 2,
            "retryCount": 3,
            "timeoutInSeconds": 120,
            "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
            "queryWindowInMin": 5,
            "startTimeAttributeName": "from",
            "endTimeAttributeName": "to",
            "headers": {
                "Accept": "application/json",
                "User-Agent": "dynatrace-microsoft-sentinel/3.x/connectors/attacks"
            },
            "queryParameters": {
                "fields": "+attacker,+request,+entrypoint,+vulnerability,+managementZones"
            }
        },
        "response": {
            "eventsJsonPaths": [
                "$.attacks"
            ],
            "convertChildPropertiesToArray": true
        },
        "dcrConfig": {
            "streamName": "Custom-DynatraceAttacks2",
            "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
            "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
        },
        "paging": {
            "pagingType": "NextPageToken",
            "pagingQueryParamOnly": true,
            "nextPageTokenJsonPath": "$.nextPageKey",
            "nextPageParaName": "nextPageKey",
            "pageSizeParaName": "pageSize",
            "pageSize": 500
        }
    }
}